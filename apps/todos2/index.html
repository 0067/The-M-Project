<!DOCTYPE html>
<!--<html manifest="cache.manifest">-->
<html>
<head>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="viewport" content="initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <link href="resources/app_icon.png" rel="apple-touch-icon" />

    <title>Todos v2.0</title>
    <script src="../../modules/jquery/jquery-1.4.4.min.js"></script>
    <script src="../../modules/jquery_mobile/jquery.mobile-1.0a2.min.js"></script>
    <script src="../../modules/underscore/underscore-min.js"></script>
    <script src="../../modules/core/foundation/m.js"></script>
    <script src="../../modules/core/foundation/object.js"></script>
    <script src="../../modules/core/utility/math.js"></script>
    <script src="../../modules/core/foundation/request.js"></script>
    <script src="../../modules/core/utility/logger.js"></script>
    <script src="../../modules/core/utility/date.js"></script>
    <script src="../../modules/core/utility/cypher_algorithms/base64.js"></script>
    <script src="../../modules/core/utility/cypher_algorithms/sha256.js"></script>
    <script src="../../modules/core/utility/cypher.js"></script>
    <script src="../../modules/core/foundation/event_dispatcher.js"></script>
    <script src="../../modules/core/foundation/observable.js"></script>
    <script src="../../modules/core/foundation/controller.js"></script>
    <script src="../../modules/core/datastore/data_provider.js"></script>
    <script src="../../modules/core/datastore/local_storage.js"></script>
    <script src="../../modules/core/datastore/validator.js"></script>
    <script src="../../modules/core/datastore/validators/email_validator.js"></script>
    <script src="../../modules/core/datastore/validators/not_minus_validator.js"></script>
    <script src="../../modules/core/datastore/validators/number_validator.js"></script>
    <script src="../../modules/core/datastore/validators/presence_validator.js"></script>
    <script src="../../modules/core/datastore/validators/date_validator.js"></script>
    <script src="../../modules/core/datastore/model_attribute.js"></script>
    <script src="../../modules/core/foundation/model.js"></script>
    <script src="../../modules/core/foundation/view.js"></script>
    <script src="../../modules/core/foundation/view_manager.js"></script>
    <script src="../../modules/core/foundation/model_registry.js"></script>
    <script src="../../modules/core/foundation/model_manager.js"></script>
    <script src="../../modules/core/foundation/application.js"></script>
    <script src="../../modules/core/utility/environment.js"></script>
    <script src="../../modules/core/utility/i18n.js"></script>

    <script src="../../modules/ui/page.js"></script>
    <script src="../../modules/ui/button.js"></script>
    <script src="../../modules/ui/toolbar.js"></script>
    <script src="../../modules/ui/scroll.js"></script>
    <script src="../../modules/ui/label.js"></script>
    <script src="../../modules/ui/button.js"></script>
    <script src="../../modules/ui/list.js"></script>
    <script src="../../modules/ui/list_item.js"></script>
    <script src="../../modules/ui/text_field.js"></script>
    <script src="../../modules/ui/grid.js"></script>
    <script src="../../modules/ui/image.js"></script>
    <script src="../../modules/ui/toggle.js"></script>
    <script src="../../modules/ui/tab_bar.js"></script>
    <script src="../../modules/ui/tab_bar_item.js"></script>
    <script src="../../modules/ui/dialog.js"></script>
    <script src="../../modules/ui/dialogs/alert_dialog.js"></script>
    <script src="../../modules/ui/dialogs/confirm_dialog.js"></script>
    <script src="../../modules/ui/dialogs/action_sheet_dialog.js"></script>
    <script src="../../modules/ui/form.js"></script>
    <script src="../../modules/ui/selection_list.js"></script>
    <script src="../../modules/ui/selection_list_item.js"></script>

    <script src="todos.js"></script>

    <link href="../../modules/themes/jquery_mobile/jquery.mobile-1.0a2.min.css" rel="stylesheet" />
    <link href="resources/style.css" rel="stylesheet" />
</head>
<body>
        <script language="JavaScript">
            Todos.app = M.Application.design({
                page1: M.PageView.design({

                    onLoad: {
                        target: Todos.TodoController,
                        action: 'init'
                    },

                    childViews: 'header content tabs',

                    header: M.ToolbarView.design({
                        childViews: 'centerLabel toggleView',

                        toggleView: M.ToggleView.design({
                            childViews: 'button1 button2',
                            anchorLocation: M.RIGHT,
                            toggleOnClick: YES,

                            button1: M.ButtonView.design({
                                value: M.I18N.l('edit'),
                                target: Todos.TodoController,
                                action: 'edit',
                                icon: 'gear'
                            }),

                            button2: M.ButtonView.design({
                                value: M.I18N.l('save'),
                                target: Todos.TodoController,
                                action: 'edit',
                                icon: 'check'
                            })
                        }),

                        centerLabel: M.LabelView.design({
                            value: 'Todos',
                            anchorLocation: M.CENTER
                        }),

                        anchorLocation: M.TOP
                    }),

                    content: M.ScrollView.design({

                        /* order in childViews string defines render order*/
                        childViews: 'todoList',

                        todoList: M.ListView.design({
                            contentBinding: 'Todos.TodoController.todos',
                            listItemTemplateView: Todos.TodoItemView
                        })

                    }),

                    tabs: Todos.tabs

                }),

                subpage1: M.PageView.design({

                    onLoad: {
                        target: Todos.TodoController,
                        action: 'init2'
                    },

                    childViews: 'header content tabs',

                    header: M.ToolbarView.design({
                        childViews: 'centerLabel toggleView',

                        showBackButton: YES,

                        toggleView: M.ToggleView.design({
                            childViews: 'button1 button2',
                            anchorLocation: M.RIGHT,

                            button1: M.ButtonView.design({
                                value: M.I18N.l('edit'),
                                target: Todos.TodoController,
                                action: 'editItem',
                                icon: 'gear'
                            }),

                            button2: M.ButtonView.design({
                                value: M.I18N.l('save'),
                                target: Todos.TodoController,
                                action: 'saveTodo',
                                icon: 'check'
                            })
                        }),

                        centerLabel: M.LabelView.design({
                            contentBinding: 'Todos.TodoController.selTitle',
                            anchorLocation: M.CENTER
                        }),

                        anchorLocation: M.TOP
                    }),

                    content: M.ToggleView.design({

                        childViews: 'content1 content2',

                        content1: M.ScrollView.design({

                            childViews: 'titleLabel title textLabel text dateLabel date',

                            titleLabel: M.LabelView.design({
                                value: M.I18N.l('title'),
                                cssClass: 'detailsLabel'
                            }),

                            title: M.LabelView.design({
                                contentBinding: 'Todos.TodoController.selTitle',
                                cssClass: 'details'
                            }),

                            textLabel: M.LabelView.design({
                                value: M.I18N.l('details'),
                                cssClass: 'detailsSpacer detailsLabel'
                            }),

                            text: M.LabelView.design({
                                contentBinding: 'Todos.TodoController.selText',
                                cssClass: 'details'
                            }),

                            dateLabel: M.LabelView.design({
                                value: M.I18N.l('due_date'),
                                cssClass: 'detailsSpacer detailsLabel'
                            }),

                            date: M.LabelView.design({
                                contentBinding: 'Todos.TodoController.selDateFormat',
                                cssClass: 'details'
                            })

                        }),

                        content2: M.ScrollView.design({

                            childViews: 'form2 del',

                            form2: M.FormView.design({

                                childViews: 'title text date',

                                showAlertOnError: YES,

                                alertTitle: M.I18N.l('error'),

                                title: M.TextFieldView.design({
                                    name: 'title',
                                    label: M.I18N.l('title'),
                                    validators: [M.PresenceValidator.customize({
                                        msg: M.I18N.l('title_req')
                                    })],
                                    cssClassOnError: 'error',
                                    contentBinding: 'Todos.TodoController.selTitle'
                                }),

                                text: M.TextFieldView.design({
                                    hasMultipleLines: YES,
                                    name: 'text',
                                    label: M.I18N.l('details'),
                                    validators: [M.PresenceValidator.customize({
                                        msg: M.I18N.l('details_req')
                                    })],
                                    cssClassOnError: 'error',
                                    contentBinding: 'Todos.TodoController.selText'
                                }),

                                date: M.TextFieldView.design({
                                    name: 'date',
                                    label: M.I18N.l('due_date'),
                                    initialText: M.I18N.l('due_date_format'),
                                    cssClassOnInit: 'textfieldInit',
                                    validators: [M.PresenceValidator.customize({
                                        msg: M.I18N.l('due_date_req')
                                    }), M.DateValidator.customize({
                                        msg: M.I18N.l('due_date_invalid')
                                    })],
                                    cssClassOnError: 'error',
                                    contentBinding: 'Todos.TodoController.selDate'
                                })

                            }),

                            del: M.ButtonView.design({
                                value: M.I18N.l('delete'),
                                cssClass: 'b',
                                target: Todos.TodoController,
                                action: 'remove'
                            })

                        })

                    }),

                    tabs: Todos.tabs

                }),

                page2: M.PageView.design({

                    childViews: 'header content tabs',

                    header: M.ToolbarView.design({
                        childViews: 'centerLabel addButton',

                        addButton: M.ButtonView.design({
                            value: M.I18N.l('add'),
                            target: Todos.TodoController,
                            action: 'addTodo',
                            icon: 'plus',
                            anchorLocation: M.RIGHT
                        }),

                        centerLabel: M.LabelView.design({
                            value: 'Todos',
                            anchorLocation: M.CENTER
                        }),

                        anchorLocation: M.TOP
                    }),

                    content: M.ScrollView.design({

                        childViews: 'form1',

                        form1: M.FormView.design({

                            childViews: 'title text date',

                            showAlertOnError: YES,

                            alertTitle: M.I18N.l('error'),

                            title: M.TextFieldView.design({
                                name: 'title',
                                label: M.I18N.l('title'),
                                validators: [M.PresenceValidator.customize({
                                    msg: M.I18N.l('title_req')
                                })],
                                cssClassOnError: 'error'
                            }),

                            text: M.TextFieldView.design({
                                hasMultipleLines: YES,
                                name: 'text',
                                label: M.I18N.l('details'),
                                validators: [M.PresenceValidator.customize({
                                    msg: M.I18N.l('details_req')
                                })],
                                cssClassOnError: 'error'
                            }),

                            date: M.TextFieldView.design({
                                name: 'date',
                                label: M.I18N.l('due_date'),
                                initialText: M.I18N.l('due_date_format'),
                                cssClassOnInit: 'textfieldInit',
                                validators: [M.PresenceValidator.customize({
                                    msg: M.I18N.l('due_date_req')
                                }), M.DateValidator.customize({
                                    msg: M.I18N.l('due_date_invalid')
                                })],
                                cssClassOnError: 'error'
                            })

                        })

                    }),

                    tabs: Todos.tabs

                }),

                page3: M.PageView.design({

                    childViews: 'header content tabs',

                    onLoad: {
                        target: Todos.LanguageController,
                        action: 'init'
                    },

                    header: M.ToolbarView.design({

                        value: M.I18N.l('settings'),

                        anchorLocation: M.TOP
                    }),

                    content: M.ScrollView.design({

                        childViews: 'langSelection',

                            langSelection: M.SelectionListView.design({

                            childViews: 'item1 item2',

                            //selectionMode: M.MULTIPLE_SELECTION,

                            selectionMode: M.SINGLE_SELECTION,

                            label: M.I18N.l('language'),

                            name: 'language',

                            onSelect: {
                                target: Todos.LanguageController,
                                action: 'changeLanguage'
                            },

                            //contentBinding: 'Todos.LanguageController.languages'

                            item1: M.SelectionListItemView.design({

                                label: M.I18N.l('german'),
                                value: 'de_de'

                            }),

                            item2: M.SelectionListItemView.design({

                                label: M.I18N.l('english'),
                                value: 'en_us'

                            })

                        })

                    }),

                    tabs: Todos.tabs

                })

            });
        </script>

        <!-- START THE APP BY CALLING THE M.APPLICATION's MAIN-METHOD -->
        <!-- in the future this call will be made automatically -->
        <script language="JavaScript">
            Todos.app.main();
        </script>

</body>
</html>